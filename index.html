<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Venteliste</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; padding: 24px; background: #f8f9fb; }
    .card { max-width: 560px; margin: 0 auto; background: #fff; border-radius: 16px; padding: 24px; box-shadow: 0 6px 24px rgba(0,0,0,.06); }
    h1 { margin: 0 0 8px; font-size: 28px; }
    p  { margin: 0 0 16px; color: #444; }
    label { display:block; margin: 14px 0 6px; font-weight: 600; }
    input, textarea { width:100%; padding:12px 14px; border:1px solid #dfe3e8; border-radius:12px; font-size:16px; box-sizing:border-box; }
    button { margin-top:16px; width:100%; padding:14px 16px; border:0; border-radius:12px; font-weight:700; font-size:16px; cursor:pointer; background:#111827; color:#fff; }
    button[disabled] { opacity:.6; cursor:wait; }
    .msg { margin-top:14px; padding:12px 14px; border-radius:12px; display:none; }
    .ok { background:#ecfdf5; border:1px solid #a7f3d0; color:#065f46; }
    .err{ background:#fef2f2; border:1px solid #fecaca; color:#991b1b; }
    .note{ font-size:12px; color:#6b7280; margin-top:8px; }
    .req { color:#ef4444; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Meld deg på ventelisten</h1>
    <p>Fyll ut skjemaet, så gir vi beskjed så snart det er ledig plass.</p>

    <form id="waitlistForm" novalidate>
      <label for="name">Navn <span class="req">*</span></label>
      <input id="name" name="name" type="text" placeholder="Ola Nordmann" required />

      <label for="email">E-post <span class="req">*</span></label>
      <input id="email" name="email" type="email" placeholder="ola@example.com" required />

      <label for="phone">Telefon</label>
      <input id="phone" name="phone" type="tel" placeholder="+47 4X XX XX XX" />

      <label for="note">Notat (valgfritt)</label>
      <textarea id="note" name="note" rows="3" placeholder="Evt. kommentar"></textarea>

      <button id="submitBtn" type="submit">Bli med på ventelisten</button>
      <div id="ok"  class="msg ok">Takk! Du er lagt til på ventelisten.</div>
      <div id="err" class="msg err">Noe gikk galt. Prøv igjen om litt.</div>
      <div class="note">Ved å sende inn samtykker du til at vi lagrer opplysningene for å kontakte deg om plass.</div>
    </form>
  </div>

  <script>
    // 1) BYTT UT DENNE MED DIN EGEN WEB APP-URL FRA APPS SCRIPT (må slutte på /exec)
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbzKNAPAglXQbh4DjRaHVEDQwPk6ByDDyLXQgZR5CIfXY4MI-VxwiTNpjVF7sm-ZO44X/exec";

    const form = document.getElementById("waitlistForm");
    const btn  = document.getElementById("submitBtn");
    const ok   = document.getElementById("ok");
    const err  = document.getElementById("err");

    function show(el){ el.style.display = "block"; }
    function hide(el){ el.style.display = "none"; }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      hide(ok); hide(err);

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      btn.disabled = true;

      // Datafeltene her MÅ matche kolonneoverskriftene du brukte i Apps Script/Google Sheet.
      // Forslag til kolonner i arket: timestamp, name, email, phone, note, source
      const payload = {
        name:  form.name.value.trim(),
        email: form.email.value.trim(),
        phone: form.phone.value.trim(),
        note:  form.note.value.trim(),
        source: "index.html" // valgfri ekstra kolonne
      };

      try {
        const res = await fetch(WEB_APP_URL, {
          method: "POST",
          mode: "cors",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (!res.ok) throw new Error("Bad response: " + res.status);

        // Hvis Apps Script returnerer JSON { success: true }
        const data = await res.json().catch(() => ({}));
        if (data.success === false) throw new Error(data.message || "Script error");

        form.reset();
        show(ok);
      } catch (e) {
        console.error(e);
        show(err);
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
